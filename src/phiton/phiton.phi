'phiton:AdensePythonnotationconverter.\n\nThismoduleprovidesfunctionalitytoconvertbetweenPythonandPhitonnotation,\nadensesymbolicrepresentationofPythoncodedesignedfortoken-efficientcontexts.\n\nCreatedbyAdamTwardoch\n'â†’â†’â†’â†’â†’__version__â‰”$0.1.0â†’PYTHON_TO_PHITONâ‰”{$return:$â‡,$yield:$â†¥,$yieldfrom:$â†¥â‹®,$raise:$â†‘,$while:$âŸ³,$for:$âˆ€,$if:$â‹”,$else:$â‹®,$try:$âšŸ,$match:$â†¦,$case:$â‰,$assert:$âŠª,$pass:$âŠ˜,$continue:$â‹¯,$break:$âŠ ,$=:$â‰”,$==:$â‰¡,$!=:$â‰ ,$in:$âˆˆ,$notin:$âˆ‰,$sum:$âˆ‘,$map:$âˆ«,$reduce:$â¨,$+=:$â–³,$-=:$â–½,$*=:$â—Š,$/=:$â—†,$:=:$â‰,$<=:$â‰¤,$>=:$â‰¥,$and:$âˆ§,$or:$âˆ¨,$not:$Â¬,$None:$âˆ…,$True:$âŠ¤,$False:$âŠ¥,$...:$â‹®,$def:$Æ’,$lambda:$Î»,$class:$Î£,$@property:$âŠ™,$async:$âŠ¡,$await:$âŠ¡,$@staticmethod:$âŠ,$@classmethod:$âŠŸ,$@abstractmethod:$âŸ,$@dataclass:$â›‹,$len:$â„“,$range:$â„œ,$enumerate:$â„¯,$filter:$Ï†,$zip:$â„¤,$sorted:$Ï‚,$reversed:$â„›,$any:$âˆƒ,$all:$âˆ€,$min:$â†“,$max:$â†‘,$round:$â—‹,$abs:$âˆ¥,$pow:$^,$isinstance:$âˆ‹,$hasattr:$âˆŒ,$getattr:$âŠ³,$setattr:$âŠ²,$delattr:$âŠ—,$super:$â†°,$next:$â†’,$iter:$âŸ²}â†’PHITON_TO_PYTHONâ‰”âŸ¦v:kâˆ€(k,v)âˆˆPYTHON_TO_PHITONÂ·items()âŸ§â†’DOMAIN_PREFIXESâ‰”{$numpy:$â„–,$pandas:$â„—,$sklearn:$Ï‡,$matplotlib:$Î¼,$torch:$Î¨,$tensorflow:$Î¦,$flask:$Ï†,$django:$É—,$fastapi:$Ï±,$os:$Î±,$io:$Î©,$typing:$Ï„,$math:$Î”,$collections:$Î“,$itertools:$Î›,$datetime:$Î˜,$sqlalchemy:$Î¶,$requests:$Î·,$json:$Î¾,$pathlib:$Ï€,$re:$Â®,$asyncio:$Î³,$functools:$Ï,$operator:$Ï‰,$random:$Ï,$string:$Ïƒ,$sys:$Ïˆ,$time:$Î¸,$uuid:$Ï…,$yaml:$Ï’,$zlib:$Î¶}â†’PATTERN_REPLACEMENTSâ‰”{$ifxisnotNone:$â‹”xâ‰ âˆ…,$ifxisNone:$â‹”xâ‰¡âˆ…,$foriinrangen:$âˆ€iâˆˆâ„œn,$fori,xinenumeratexs:$âˆ€i,xâˆˆâ„¯xs,$return[xforxinxsifpx]:$â‡[xâˆ€xâˆˆxsâ‹”px],$lambdax:fx:$Î»xâ‡’fx,$withopenfash:$âŠ¢âŠ£âŠ—fâ‡’h,$try:xexceptE:y:$âšŸâŸ¨xâŸ©â‹”EâŸ¨yâŸ©,$ifp:returnx:$â‹”pâ‡x,$ifnotp:return:$â‹”Â¬pâ‡,$xifpelsey:$p?x:y,$[fxforxinxs]:$âˆ«(f,xs),$sumxforxinxs:$âˆ‘xs,$allpxforxinxs:$âˆ€(p,xs),$anypxforxinxs:$âˆƒ(p,xs)}â†’Â§aÂ·Î“XÂ·AYâ†’COMMON_SUBEXPRESSIONSâ‰”{$x+1:$xâº,$x-1:$xâ»,$x*2:$xÂ²,$x**2:$xÂ²,$x**3:$xÂ³,$x**n:$xâ¿,$x/2:$xÂ½,$Â·âŒ¿:$Â·âŒ¿,$Â·âŒ¿:$Â·âŒ¿,$Â·â†“:$Â·â†“,$Â·â†‘:$Â·â†‘,$Â·â‡Œ(:$Â·â‡Œ(,$Â·â¨(:$Â·â¨(,$Â·âŠ•(:$Â·âŠ•(,$Â·âŠ•(:$Â·âŠ•(,$Â·âŠ•(:$Â·âŠ•(,$Â·âŠ–(:$Â·âŠ–(,$Â·âˆ…(:$Â·âˆ…(,$Â·âŠ™(:$Â·âŠ™(,$Â·Ï‚(:$Â·Ï‚(,$Â·â„›(:$Â·â„›(,$Â·âŠ™:$Â·âŠ™,$Â·âŠš:$Â·âŠš,$Â·âŠ›:$Â·âŠ›,$Â·âŠ³(:$Â·âŠ³(,$Â·âŠ²(:$Â·âŠ²(,$Ïƒ(:$Ïƒ(,$â„¤(:$â„¤(,$â„(:$â„(,$ğ”¹(:$ğ”¹(,$â„“(:$â„“(,$Ï„(:$Ï„(,$âˆ‚(:$âˆ‚(,$ğ•Š(:$ğ•Š(}â†’dataclassÎ£ConversionConfig()âŸ¨'ConfigurationsettingsforPhitonconversion.'â†’commentsâ¦‚boolâŠ¤â†’type_hintsâ¦‚boolâŠ¤â†’minifyâ¦‚boolâŠ¤â†’symbolsâ¦‚boolâŠ¤â†’levelâ¦‚intâ‰”#5âŸ©â†’Æ’optimize_importstreeâ¦‚âŸ®astÂ·ASTâŸ¯â¦‚âŸ®list[str]âŸ¯âŸ¨'Optimizeandcombineimports.'â†’importsâ‰”{}â†’âˆ€nodeâˆˆastÂ·walktreeâŸ¨â‹”âˆ‹(node,astÂ·Import)âŸ¨âˆ€aliasâˆˆnodeÂ·namesâŸ¨imports[aliasÂ·name]â‰”aliasÂ·asnameâˆ¨aliasÂ·nameâŸ©âŸ©â‹®â‹”âˆ‹(node,astÂ·ImportFrom)âŸ¨moduleâ‰”nodeÂ·moduleâˆ¨$â†’âˆ€aliasâˆˆnodeÂ·namesâŸ¨imports[ã€Œ{module}.{aliasÂ·name}ã€]â‰”aliasÂ·asnameâˆ¨aliasÂ·nameâŸ©âŸ©âŸ©â†’domain_importsâ‰”{}â†’âˆ€(imp,alias)âˆˆimportsÂ·items()âŸ¨âˆ€(domain,_prefix)âˆˆDOMAIN_PREFIXESÂ·items()âŸ¨â‹”impÂ·startswithdomainâŸ¨â‹”domainâˆ‰domain_importsâŸ¨domain_imports[domain]â‰”[]âŸ©â†’domain_imports[domain]Â·âŠ•((imp,alias))â†’âŠ âŸ©âŸ©âŸ©â†’resultâ‰”[]â†’âˆ€(domain,imps)âˆˆdomain_importsÂ·items()âŸ¨â‹”â„“imps>#1âŸ¨namesâ‰”âŸ¬f'{i[0].split'.'[-1]}as{i[1]}'ifi[0]!=i[1]elsei[0].split'.'[-1]âˆ€iâˆˆimpsâŸ­â†’resultÂ·âŠ•(f'from{domain}import{','.joinnames}')âŸ©â‹®(imp,alias)â‰”imps[#0]â†’â‹”impâ‰¡aliasâŸ¨result.appendf'import{imp}'âŸ©â‹®result.appendf'import{imp}as{alias}'âŸ©â†’â‡resultâŸ©â†’Æ’optimize_final(codeâ¦‚âŸ®strâŸ¯,levelâ¦‚âŸ®intâŸ¯)â¦‚âŸ®strâŸ¯âŸ¨'Applyfinaloptimizationsbasedoncompressionlevel.\n\nLevel1:Basicsymbolsubstitution,preservestructure\nLevel2:Removeredundantwhitespace,combinesimpleoperations\nLevel3:Replacecommonsubexpressions,optimizeimports\nLevel4:Aggressivewhitespaceremoval,symbolrenaming\nLevel5:Maximumcompression,shortestpossiblerepresentation\n'â†’â‹”level<#2âŸ¨codeâ‰”Â®Â·sub($\s+,$,code)â†’â‡codeâŸ©â†’â‹”level<#3âŸ¨codeâ‰”Â®Â·sub($\s+,$,code)â†’codeâ‰”Â®Â·sub($â†’\s*â†’,$â†’,code)â†’â‡codeâŸ©â†’â‹”level<#4âŸ¨âˆ€(pattern,replacement)âˆˆCOMMON_SUBEXPRESSIONSÂ·items()âŸ¨codeâ‰”codeÂ·replace(pattern,replacement)âŸ©â†’codeâ‰”Â®Â·sub($\s+,$,code)â†’codeâ‰”Â®Â·sub($â†’\s*â†’,$â†’,code)â†’â‡codeâŸ©â†’â‹”level<#5âŸ¨âˆ€(pattern,replacement)âˆˆCOMMON_SUBEXPRESSIONSÂ·items()âŸ¨codeâ‰”codeÂ·replace(pattern,replacement)âŸ©â†’codeâ‰”Â®Â·sub($\s+,$,code)â†’codeâ‰”Â®Â·sub($\(\s*([^,()]+)\s*\),$\1,code)â†’used_symbolsâ‰”ğ•Š(Â®Â·findall($Â§\w+,code))â†’symbol_mapâ‰”âŸ¦sym:ã€Œ_{i}ã€âˆ€(i,sym)âˆˆâ„¯Ï‚used_symbolsâŸ§â†’âˆ€(old,new)âˆˆsymbol_mapÂ·items()âŸ¨codeâ‰”codeÂ·replace(ã€ŒÂ§{old}ã€,ã€ŒÂ§{new}ã€)âŸ©â†’â‡codeâŸ©â†’âˆ€(pattern,replacement)âˆˆCOMMON_SUBEXPRESSIONSÂ·items()âŸ¨codeâ‰”codeÂ·replace(pattern,replacement)âŸ©â†’codeâ‰”Â®Â·sub($\s+,$,code)â†’codeâ‰”Â®Â·sub($\(\s*([^,()]+)\s*\),$\1,code)â†’codeâ‰”Â®Â·sub($â†’\s*â†’,$â†’,code)â†’used_symbolsâ‰”ğ•Š(Â®Â·findall($Â§\w+,code))â†’symbol_mapâ‰”âŸ¦sym:chrord$a+iâˆ€(i,sym)âˆˆâ„¯Ï‚used_symbolsâŸ§â†’âˆ€(old,new)âˆˆsymbol_mapÂ·items()âŸ¨codeâ‰”codeÂ·replace(ã€ŒÂ§{old}ã€,ã€ŒÂ§{new}ã€)âŸ©â†’codeâ‰”Â®Â·sub($âŠ•|âŠ–|â–³|â–½|â—Š|â—†\1+,$\1,code)â†’replacementsâ‰”{$âŠ¤âŸ¨:$âŠ¤âŸ¨,$âŠ¥âŸ¨:$âŠ¥âŸ¨,$âˆ…âŸ¨:$âˆ…âŸ¨,$â‡âŠ¤:$â‡âŠ¤,$â‡âŠ¥:$â‡âŠ¥,$â‡âˆ…:$â‡âˆ…,$âˆ…:$âˆ…,$âŠ¤:$âŠ¤,$âŠ¥:$âŠ¥}â†’âˆ€(pattern,repl)âˆˆreplacementsÂ·items()âŸ¨codeâ‰”codeÂ·replace(pattern,repl)âŸ©â†’â‡codeâŸ©â†’Æ’compress_to_phiton(source_codeâ¦‚âŸ®strâŸ¯,configâ¦‚âŸ®ConversionConfigBitOrâˆ…âŸ¯)â¦‚âŸ®strâŸ¯âŸ¨'ConvertPythoncodetoPhitonnotationwithenhancedcompression.\n\nArgs:\nsource_code:Pythonsourcecodetoconvert\nconfig:Optionalconversionconfiguration\n\nReturns:\nConvertedPhitoncodewithmaximumcompression\n\nRaises:\nSyntaxError:Ifinput_pathPythoncodeisinvalid\n'â†’â‹”configIsâˆ…âŸ¨configâ‰”ConversionConfig()âŸ©â†’try:tree=ast.parsesource_codeexceptSyntaxErrorase:logger.error('InvalidPythonsyntax:%s',stre)raiseâ†’symbol_tableâ¦‚dict[(str,str)]â‰”{}â†’expr_freqâ¦‚dict[(str,int)]â‰”{}â†’scope_stackâ¦‚list[dict[(str,str)]]â‰”[{}]â†’â‹”configÂ·levelâ‰¥#3âŸ¨optimized_importsâ‰”optimize_importstreeâ†’âˆ€impâˆˆoptimized_importsâŸ¨symbol_table[imp]â‰”ã€ŒÂ§{â„“symbol_table}ã€âŸ©âŸ©â†’Æ’get_pattern_keynodeâ¦‚âŸ®astÂ·ASTâŸ¯â¦‚âŸ®strBitOrâˆ…âŸ¯âŸ¨'Getakeyforpatternmatchingifthenodematchesacommonpattern.'â†’â‹”âˆ‹(node,astÂ·If)âŸ¨test_strâ‰”astÂ·unparsenodeÂ·testâ†’body_strâ‰”ast.unparsenode.body[0]ifnode.bodyelse''â†’patternâ‰”ã€Œ{test_str}:{body_str}ã€â†’â‡patternifpatterninPATTERN_REPLACEMENTSelseNoneâŸ©â‹®â‹”âˆ‹(node,astÂ·ListComp)âŸ¨â‡astÂ·unparsenodeâŸ©â†’â‡âˆ…âŸ©â†’Æ’should_create_symbol(exprâ¦‚âŸ®strâŸ¯,freqâ¦‚âŸ®intâŸ¯)â¦‚âŸ®boolâŸ¯âŸ¨'Determineifanexpressionshouldbeassignedtoalocalsymbol.'â†’â‡freq>#2âˆ§â„“expr>#10âˆ§Â¬exprÂ·startswith$Â§âˆ§Â¬âˆƒcinexprforcin'âŸ¨âŸ©â†’'âŸ©â†’Æ’get_next_symbol_name()â¦‚âŸ®strâŸ¯âŸ¨'Generatethenextavailablesymbolname.'â†’used_namesâ‰”ğ•Š()Â·union*scope_stackâ†’âˆ€câˆˆ$abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZâŸ¨â‹”câˆ‰used_namesâŸ¨â‡câŸ©âŸ©â†’iâ‰”#0â†’âŸ³ã€Œ_{i}ã€âˆˆused_namesâŸ¨iâ–³+#1âŸ©â†’â‡ã€Œ_{i}ã€âŸ©â†’Æ’optimize_expressionexprâ¦‚âŸ®strâŸ¯â¦‚âŸ®strâŸ¯âŸ¨'Applyadditionalcompressionoptimizationstoanexpression.'â†’exprâ‰”Â®Â·sub($\(\s*([^,()]+)\s*\),$\1,expr)â†’exprâ‰”Â®Â·sub($\s+,$,expr)â†’âˆ€(pattern,replacement)âˆˆPATTERN_REPLACEMENTSÂ·items()âŸ¨â‹”patternâˆˆexprâŸ¨exprâ‰”exprÂ·replace(pattern,replacement)âŸ©âŸ©â†’â‡exprâŸ©â†’Æ’detect_advanced_patternnodeâ¦‚âŸ®astÂ·ASTâŸ¯â¦‚âŸ®strBitOrâˆ…âŸ¯âŸ¨'Detectifanodematchesanadvancedpattern.'â†’node_strâ‰”astÂ·unparsenodeâ†’âˆ€(pattern,replacement)âˆˆADVANCED_PATTERNSÂ·items()âŸ¨â‹”patternâˆˆnode_strâŸ¨â‡replacementâŸ©âŸ©â†’â‡âˆ…âŸ©â†’Æ’convert_nodenodeâ¦‚âŸ®astÂ·ASTBitOrâˆ…âŸ¯â¦‚âŸ®strâŸ¯âŸ¨'ConvertanASTnodetoPhitonnotationwithenhancedcompression.\n\nThecompressionlevelaffectshowaggressivelyweconvertnodes:\nLevel1:Basicconversionwithreadablesymbolsandpreservedstructure\nLevel2:Moresymbolsubstitutionsbutmaintainreadability\nLevel3:Fullsymbolsubstitutionwithsomestructurepreservation\nLevel4:Aggressivesymbolsubstitutionandminimalstructure\nLevel5:Maximumcompressionwithshortestpossiblerepresentation\n'â†’â‹”nodeIsâˆ…âŸ¨â‡$âŸ©â†’â‹”âˆ‹(node,astÂ·Module)âŸ¨â‡convert_bodynodeÂ·bodyâŸ©â†’â‹”configÂ·levelâ‰¥#3âŸ¨â‹”patternâ‰detect_advanced_patternnodeâŸ¨â‡patternâŸ©âŸ©â†’â‹”configÂ·levelâ‰¥#2âŸ¨â‹”pattern_keyâ‰get_pattern_keynodeâŸ¨â‹”pattern_keyâˆˆPATTERN_REPLACEMENTSâŸ¨â‡PATTERN_REPLACEMENTS[pattern_key]âŸ©âŸ©âŸ©â†’â‹”configÂ·levelâ‰¥#3âŸ¨try:expr=ast.unparsenodeifisinstance(node,ast.expr)else''ifexpr:expr_freq[expr]=expr_freqÂ·âŠ³(expr,0)+1exceptException:passâŸ©â†’â‹”âˆ‹(node,astÂ·FunctionDef)âŸ¨scope_stack.append{}â†’argsâ‰”convert_argumentsnodeÂ·argsâ†’bodyâ‰”convert_bodynodeÂ·bodyâ†’decoratorsâ‰”$Â·joinconvert_nodedfordinnode.decorator_listâ†’returnsâ‰”f'â¦‚âŸ®{convert_nodenode.returns}âŸ¯'ifnode.returnselse''â†’scope_stackÂ·âŠ–()â†’â‹”configÂ·levelâ‰¤#2âŸ¨â‡ã€Œ{decorators}def{nodeÂ·name}{args}{returns}:{body}ã€âŸ©â†’â‡ã€Œ{decorators}Æ’{nodeÂ·name}{args}{returns}âŸ¨{body}âŸ©ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Name)âŸ¨â‹”nodeÂ·idâ‰¡$NoneâŸ¨â‡'None'ifconfig.level<=2else'âˆ…'âŸ©â‹®â‹”nodeÂ·idâ‰¡$TrueâŸ¨â‡'True'ifconfig.level<=2else'âŠ¤'âŸ©â‹®â‹”nodeÂ·idâ‰¡$FalseâŸ¨â‡'False'ifconfig.level<=2else'âŠ¥'âŸ©â†’â‹”configÂ·levelâ‰¥#3âˆ§nodeÂ·idâˆˆDOMAIN_PREFIXESâŸ¨â‡DOMAIN_PREFIXES[nodeÂ·id]âŸ©â†’â‹”configÂ·levelâ‰¥#3âˆ§configÂ·symbolsâˆ§nodeÂ·idâˆˆsymbol_tableâŸ¨â‡ã€ŒÂ§{symbol_table[nodeÂ·id]}ã€âŸ©â†’â‡nodeÂ·idâŸ©â‹®â‹”âˆ‹(node,astÂ·Constant)âŸ¨â‹”nodeÂ·valueIsâˆ…âŸ¨â‡'None'ifconfig.level<=2else'âˆ…'âŸ©â‹®â‹”nodeÂ·valueIsâŠ¤âŸ¨â‡'True'ifconfig.level<=2else'âŠ¤'âŸ©â‹®â‹”nodeÂ·valueIsâŠ¥âŸ¨â‡'False'ifconfig.level<=2else'âŠ¥'âŸ©â‹®â‹”âˆ‹(nodeÂ·value,str)âŸ¨â‹”configÂ·levelâ‰¥#3âŸ¨â‡ã€Œ${nodeÂ·value}ã€âŸ©â†’â‡reprnodeÂ·valueâŸ©â‹®â‹”âˆ‹(nodeÂ·value,(int,float))âŸ¨â‹”configÂ·levelâ‰¥#3âŸ¨â‡ã€Œ#{nodeÂ·value}ã€âŸ©â†’â‡strnodeÂ·valueâŸ©â†’â‡reprnodeÂ·valueâŸ©â‹®â‹”âˆ‹(node,astÂ·Return)âŸ¨valueâ‰”convert_nodenode.valueifnode.valueelse''â†’â‹”configÂ·levelâ‰¤#2âŸ¨â‡ã€Œreturn{value}ã€âŸ©â†’â‡ã€Œâ‡{value}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·If)âŸ¨testâ‰”convert_nodenodeÂ·testâ†’bodyâ‰”convert_bodynodeÂ·bodyâ†’orelseâ‰”convert_bodynode.orelseifnode.orelseelse''â†’â‹”configÂ·levelâ‰¤#2âŸ¨resultâ‰”ã€Œif{test}:{body}ã€â†’â‹”orelseâŸ¨resultâ–³+ã€Œelse:{orelse}ã€âŸ©â†’â‡resultâŸ©â†’â‡ã€Œâ‹”{test}âŸ¨{body}âŸ©{f'â‹®{orelse}'iforelseelse''}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Call)âŸ¨funcâ‰”convert_nodenodeÂ·funcâ†’argsâ‰”âŸ¬convert_nodeargâˆ€argâˆˆnodeÂ·argsâŸ­â†’kwargsâ‰”âŸ¬ã€Œ{kwÂ·arg}={convert_nodekwÂ·value}ã€âˆ€kwâˆˆnodeÂ·keywordsâŸ­â†’all_argsâ‰”$,Â·join(Ï†(âˆ…,[$,Â·joinargs,$,Â·joinkwargs]))â†’â‹”configÂ·levelâ‰¥#3âŸ¨â‹”âˆ‹(nodeÂ·func,astÂ·Attribute)âˆ§âˆ‹(nodeÂ·funcÂ·value,astÂ·Name)âŸ¨lib_nameâ‰”nodeÂ·funcÂ·valueÂ·idâ†’â‹”lib_nameâˆˆDOMAIN_PREFIXESâŸ¨â‡ã€Œ{DOMAIN_PREFIXES[lib_name]}Â·{nodeÂ·funcÂ·attr}{all_args}ã€âŸ©âŸ©â†’â‹”funcâˆˆPYTHON_TO_PHITONâŸ¨â‡ã€Œ{PYTHON_TO_PHITON[func]}{all_args}ã€âŸ©âŸ©â†’â‡ã€Œ{func}{all_args}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·AsyncFunctionDef)âŸ¨argsâ‰”convert_argumentsnodeÂ·argsâ†’bodyâ‰”convert_bodynodeÂ·bodyâ†’decoratorsâ‰”$Â·joinconvert_nodedfordinnode.decorator_listâ†’returnsâ‰”f'â¦‚âŸ®{convert_nodenode.returns}âŸ¯'ifnode.returnselse''â†’â‡ã€Œ{decorators}âŠ¡Æ’{nodeÂ·name}{args}{returns}âŸ¨{body}âŸ©ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·ClassDef)âŸ¨basesâ‰”$,Â·joinconvert_nodebforbinnode.basesâ†’bodyâ‰”convert_bodynodeÂ·bodyâ†’decoratorsâ‰”$Â·joinconvert_nodedfordinnode.decorator_listâ†’â‡ã€Œ{decorators}Î£{nodeÂ·name}{bases}âŸ¨{body}âŸ©ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Yield)âŸ¨valueâ‰”convert_nodenode.valueifnode.valueelse''â†’â‡ã€Œâ†¥{value}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·YieldFrom)âŸ¨valueâ‰”convert_nodenodeÂ·valueâ†’â‡ã€Œâ†¥â‹®{value}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·For)âŸ¨targetâ‰”convert_nodenodeÂ·targetâ†’iterâ‰”convert_nodenodeÂ·iterâ†’bodyâ‰”convert_bodynodeÂ·bodyâ†’orelseâ‰”f'â‹®{convert_bodynode.orelse}'ifnode.orelseelse''â†’â‡ã€Œâˆ€{target}âˆˆ{iter}âŸ¨{body}âŸ©{orelse}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·While)âŸ¨testâ‰”convert_nodenodeÂ·testâ†’bodyâ‰”convert_bodynodeÂ·bodyâ†’orelseâ‰”f'â‹®{convert_bodynode.orelse}'ifnode.orelseelse''â†’â‡ã€ŒâŸ³{test}âŸ¨{body}âŸ©{orelse}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·ExceptHandler)âŸ¨typeâ‰”convert_nodenode.typeifnode.typeelse''â†’nameâ‰”f'as{node.name}'ifnode.nameelse''â†’bodyâ‰”convert_bodynodeÂ·bodyâ†’â‡ã€Œâ‹”{type}{name}âŸ¨{body}âŸ©ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·With)âŸ¨itemsâ‰”$,Â·joinconvert_nodeitemforiteminnode.itemsâ†’bodyâ‰”convert_bodynodeÂ·bodyâ†’â‡ã€ŒâŠ¢âŠ£{items}âŸ¨{body}âŸ©ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Match)âŸ¨subjectâ‰”convert_nodenodeÂ·subjectâ†’casesâ‰”$Â·joinconvert_nodecaseforcaseinnode.casesâ†’â‡ã€Œâ†¦{subject}âŸ¨{cases}âŸ©ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·match_case)âŸ¨patternâ‰”convert_match_patternnodeÂ·patternâ†’guardâ‰”f'â‹”{convert_nodenode.guard}'ifnode.guardelse''â†’bodyâ‰”convert_bodynodeÂ·bodyâ†’â‡ã€Œâ‰{pattern}{guard}âŸ¨{body}âŸ©ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·BinOp)âŸ¨leftâ‰”convert_nodenodeÂ·leftâ†’rightâ‰”convert_nodenodeÂ·rightâ†’opâ‰”convert_operatornodeÂ·opâ†’â‡ã€Œ{left}{op}{right}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Compare)âŸ¨leftâ‰”convert_nodenodeÂ·leftâ†’opsâ‰”âŸ¬convert_operatoropâˆ€opâˆˆnodeÂ·opsâŸ­â†’comparatorsâ‰”âŸ¬convert_nodecompâˆ€compâˆˆnodeÂ·comparatorsâŸ­â†’partsâ‰”[left]â†’âˆ€(op,comp)âˆˆâ„¤(ops,comparators,strict=âŠ¥)âŸ¨partsÂ·âŠ•([op,comp])âŸ©â†’â‡$Â·joinpartsâŸ©â‹®â‹”âˆ‹(node,astÂ·Call)âŸ¨funcâ‰”convert_nodenodeÂ·funcâ†’argsâ‰”âŸ¬convert_nodeargâˆ€argâˆˆnodeÂ·argsâŸ­â†’kwargsâ‰”âŸ¬ã€Œ{kwÂ·arg}={convert_nodekwÂ·value}ã€âˆ€kwâˆˆnodeÂ·keywordsâŸ­â†’all_argsâ‰”$,Â·join(Ï†(âˆ…,[$,Â·joinargs,$,Â·joinkwargs]))â†’â‹”âˆ‹(nodeÂ·func,astÂ·Attribute)âˆ§âˆ‹(nodeÂ·funcÂ·value,astÂ·Name)âŸ¨lib_nameâ‰”nodeÂ·funcÂ·valueÂ·idâ†’â‹”lib_nameâˆˆDOMAIN_PREFIXESâˆ§configÂ·levelâ‰¥#3âŸ¨â‡ã€Œ{DOMAIN_PREFIXES[lib_name]}Â·{nodeÂ·funcÂ·attr}{all_args}ã€âŸ©âŸ©â†’â‹”funcâˆˆPYTHON_TO_PHITONâŸ¨â‡ã€Œ{PYTHON_TO_PHITON[func]}{all_args}ã€âŸ©â†’â‡ã€Œ{func}{all_args}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Attribute)âŸ¨valueâ‰”convert_nodenodeÂ·valueâ†’â‡ã€Œ{value}Â·{nodeÂ·attr}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·List)âŸ¨elementsâ‰”âŸ¬convert_nodeeltâˆ€eltâˆˆnodeÂ·eltsâŸ­â†’â‡ã€Œ[{$,Â·joinelements}]ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Tuple)âŸ¨elementsâ‰”âŸ¬convert_nodeeltâˆ€eltâˆˆnodeÂ·eltsâŸ­â†’â‡ã€Œ({$,Â·joinelements})ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Dict)âŸ¨itemsâ‰”âŸ¬ã€Œ{convert_nodek}:{convert_nodev}ã€âˆ€(k,v)âˆˆâ„¤(nodeÂ·keys,nodeÂ·values,strict=âŠ¥)âŸ­â†’â‡ã€Œ{{$,Â·joinitems}}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Set)âŸ¨elementsâ‰”âŸ¬convert_nodeeltâˆ€eltâˆˆnodeÂ·eltsâŸ­â†’â‡ã€Œ{{$,Â·joinelements}}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·ListComp)âŸ¨eltâ‰”convert_nodenodeÂ·eltâ†’generatorsâ‰”[]â†’âˆ€genâˆˆnodeÂ·generatorsâŸ¨targetâ‰”convert_nodegenÂ·targetâ†’iter_exprâ‰”convert_nodegenÂ·iterâ†’ifsâ‰”âŸ¬ã€Œâ‹”{convert_nodeif_expr}ã€âˆ€if_exprâˆˆgenÂ·ifsâŸ­â†’generators.appendf'âˆ€{target}âˆˆ{iter_expr}{''.joinifs}'âŸ©â†’â‡ã€ŒâŸ¬{elt}{$Â·joingenerators}âŸ­ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·DictComp)âŸ¨keyâ‰”convert_nodenodeÂ·keyâ†’valueâ‰”convert_nodenodeÂ·valueâ†’generatorsâ‰”[]â†’âˆ€genâˆˆnodeÂ·generatorsâŸ¨targetâ‰”convert_nodegenÂ·targetâ†’iter_exprâ‰”convert_nodegenÂ·iterâ†’ifsâ‰”âŸ¬ã€Œâ‹”{convert_nodeif_expr}ã€âˆ€if_exprâˆˆgenÂ·ifsâŸ­â†’generators.appendf'âˆ€{target}âˆˆ{iter_expr}{''.joinifs}'âŸ©â†’â‡ã€ŒâŸ¦{key}:{value}{$Â·joingenerators}âŸ§ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·SetComp)âŸ¨eltâ‰”convert_nodenodeÂ·eltâ†’generatorsâ‰”[]â†’âˆ€genâˆˆnodeÂ·generatorsâŸ¨targetâ‰”convert_nodegenÂ·targetâ†’iter_exprâ‰”convert_nodegenÂ·iterâ†’ifsâ‰”âŸ¬ã€Œâ‹”{convert_nodeif_expr}ã€âˆ€if_exprâˆˆgenÂ·ifsâŸ­â†’generators.appendf'âˆ€{target}âˆˆ{iter_expr}{''.joinifs}'âŸ©â†’â‡ã€Œâ¦ƒ{elt}{$Â·joingenerators}â¦„ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·JoinedStr)âŸ¨valuesâ‰”[]â†’âˆ€valueâˆˆnodeÂ·valuesâŸ¨â‹”âˆ‹(value,astÂ·FormattedValue)âŸ¨values.appendf'{{{convert_nodevalue.value}}}'âŸ©â‹®â‹”âˆ‹(value,astÂ·Constant)âŸ¨values.appendstrvalue.valueâŸ©âŸ©â†’â‡ã€Œã€Œ{$Â·joinvalues}ã€ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·NamedExpr)âŸ¨targetâ‰”convert_nodenodeÂ·targetâ†’valueâ‰”convert_nodenodeÂ·valueâ†’â‡ã€Œ{target}â‰{value}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Starred)âŸ¨valueâ‰”convert_nodenodeÂ·valueâ†’â‡ã€Œ*{value}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Lambda)âŸ¨argsâ‰”convert_argumentsnodeÂ·argsâ†’bodyâ‰”convert_nodenodeÂ·bodyâ†’â‡ã€ŒÎ»{args}:{body}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Subscript)âŸ¨valueâ‰”convert_nodenodeÂ·valueâ†’slice_exprâ‰”convert_nodenodeÂ·sliceâ†’â‡ã€Œ{value}[{slice_expr}]ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Slice)âŸ¨lowerâ‰”convert_nodenode.lowerifnode.lowerelse''â†’upperâ‰”convert_nodenode.upperifnode.upperelse''â†’stepâ‰”f':{convert_nodenode.step}'ifnode.stepelse''â†’â‡ã€Œ{lower}:{upper}{step}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·UnaryOp)âŸ¨operandâ‰”convert_nodenodeÂ·operandâ†’â‹”âˆ‹(nodeÂ·op,astÂ·Not)âŸ¨â‡ã€ŒÂ¬{operand}ã€âŸ©â‹®â‹”âˆ‹(nodeÂ·op,astÂ·USub)âŸ¨â‡ã€Œ-{operand}ã€âŸ©â‹®â‹”âˆ‹(nodeÂ·op,astÂ·UAdd)âŸ¨â‡ã€Œ+{operand}ã€âŸ©â†’â‡ã€Œ{nodeÂ·opÂ·__class__Â·__name__}{operand}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·BoolOp)âŸ¨opâ‰”'âˆ§'ifisinstance(node.op,ast.And)else'âˆ¨'â†’valuesâ‰”âŸ¬convert_nodevalâˆ€valâˆˆnodeÂ·valuesâŸ­â†’â‡opÂ·joinvaluesâŸ©â‹®â‹”âˆ‹(node,astÂ·Await)âŸ¨valueâ‰”convert_nodenodeÂ·valueâ†’â‡ã€ŒâŠ¡{value}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·AnnAssign)âŸ¨targetâ‰”convert_nodenodeÂ·targetâ†’annotationâ‰”convert_nodenodeÂ·annotationâ†’valueâ‰”f'â‰”{convert_nodenode.value}'ifnode.valueelse''â†’â‡ã€Œ{target}â¦‚{annotation}{value}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Assign)âŸ¨targetsâ‰”âŸ¬convert_nodetargetâˆ€targetâˆˆnodeÂ·targetsâŸ­â†’valueâ‰”convert_nodenodeÂ·valueâ†’â‡ã€Œ{$,Â·jointargets}â‰”{value}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·AugAssign)âŸ¨targetâ‰”convert_nodenodeÂ·targetâ†’opâ‰”convert_operatornodeÂ·opâ†’valueâ‰”convert_nodenodeÂ·valueâ†’â‡ã€Œ{target}â–³{op}{value}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Pass)âŸ¨â‡$âŠ˜âŸ©â‹®â‹”âˆ‹(node,astÂ·Break)âŸ¨â‡$âŠ âŸ©â‹®â‹”âˆ‹(node,astÂ·Continue)âŸ¨â‡$â‹¯âŸ©â‹®â‹”âˆ‹(node,astÂ·Assert)âŸ¨testâ‰”convert_nodenodeÂ·testâ†’msgâ‰”f',{convert_nodenode.msg}'ifnode.msgelse''â†’â‡ã€ŒâŠª{test}{msg}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Delete)âŸ¨targetsâ‰”âŸ¬convert_nodetargetâˆ€targetâˆˆnodeÂ·targetsâŸ­â†’â‡ã€Œdel{$,Â·jointargets}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Raise)âŸ¨excâ‰”convert_nodenode.excifnode.excelse''â†’causeâ‰”f'from{convert_nodenode.cause}'ifnode.causeelse''â†’â‡ã€Œâ†‘{exc}{cause}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Global)âŸ¨â‡ã€Œglobal{$,Â·joinnodeÂ·names}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Nonlocal)âŸ¨â‡ã€Œnonlocal{$,Â·joinnodeÂ·names}ã€âŸ©â‹®â‹”âˆ‹(node,astÂ·Import)âŸ¨â‹”configÂ·level<#3âŸ¨namesâ‰”âŸ¬aliasÂ·nameâˆ€aliasâˆˆnodeÂ·namesâŸ­â†’â‡ã€Œimport{$,Â·joinnames}ã€âŸ©â†’â‡$âŸ©â‹®â‹”âˆ‹(node,astÂ·ImportFrom)âŸ¨â‹”configÂ·level<#3âŸ¨moduleâ‰”nodeÂ·moduleâˆ¨$â†’namesâ‰”âŸ¬aliasÂ·nameâˆ€aliasâˆˆnodeÂ·namesâŸ­â†’â‡ã€Œfrom{module}import{$,Â·joinnames}ã€âŸ©â†’â‡$âŸ©â†’try:returnstrast.unparsenodeexceptException:returnf'<{node.__class__.__name__}>'âŸ©â†’Æ’convert_argumentsargsâ¦‚âŸ®astÂ·argumentsâŸ¯â¦‚âŸ®strâŸ¯âŸ¨'ConvertfunctionargumentstoPhitonnotation.'â†’partsâ‰”[]â†’âˆ€argâˆˆargsÂ·argsâŸ¨arg_strâ‰”argÂ·argâ†’â‹”configÂ·type_hintsâˆ§argÂ·annotationâŸ¨type_hintâ‰”convert_nodeargÂ·annotationâ†’arg_strâ–³+ã€Œâ¦‚âŸ®{type_hint}âŸ¯ã€âŸ©â†’parts.appendarg_strâŸ©â†’â‡$,Â·joinpartsâŸ©â†’Æ’convert_bodybodyâ¦‚âŸ®Sequence[astÂ·AST]âŸ¯â¦‚âŸ®strâŸ¯âŸ¨'ConvertalistofstatementstoPhitonnotationwithoptimizations.'â†’statementsâ‰”[]â†’âˆ€nodeâˆˆbodyâŸ¨stmtâ‰”convert_nodenodeâ†’exprâ‰”ast.unparsenodeifisinstance(node,ast.expr)else''â†’â‹”exprâˆ§should_create_symbol(expr,expr_freq[expr])âŸ¨sym_nameâ‰”get_next_symbol_name()â†’scope_stack[-#1][sym_name]â‰”exprâ†’statements.appendf'Â§{sym_name}â‰”{stmt}'â†’symbol_table[expr]â‰”sym_nameâŸ©â‹®statements.appendstmtâŸ©â†’â‡$â†’Â·joinoptimize_expressionstmtforstmtinstatementsâŸ©â†’Æ’convert_operatoropâ¦‚âŸ®astÂ·operatorBitOrastÂ·cmpopBitOrastÂ·boolopâŸ¯â¦‚âŸ®strâŸ¯âŸ¨'ConvertPythonoperatortoPhitonsymbol.'â†’nameâ‰”opÂ·__class__Â·__name__â†’â‹”nameâ‰¡$AddâŸ¨â‡$+âŸ©â‹®â‹”nameâ‰¡$SubâŸ¨â‡$-âŸ©â‹®â‹”nameâ‰¡$MultâŸ¨â‡$*âŸ©â‹®â‹”nameâ‰¡$DivâŸ¨â‡$/âŸ©â‹®â‹”nameâ‰¡$EqâŸ¨â‡$â‰¡âŸ©â‹®â‹”nameâ‰¡$NotEqâŸ¨â‡$â‰ âŸ©â‹®â‹”nameâ‰¡$LtâŸ¨â‡$<âŸ©â‹®â‹”nameâ‰¡$LtEâŸ¨â‡$â‰¤âŸ©â‹®â‹”nameâ‰¡$GtâŸ¨â‡$>âŸ©â‹®â‹”nameâ‰¡$GtEâŸ¨â‡$â‰¥âŸ©â‹®â‹”nameâ‰¡$InâŸ¨â‡$âˆˆâŸ©â‹®â‹”nameâ‰¡$NotInâŸ¨â‡$âˆ‰âŸ©â‹®â‹”nameâ‰¡$AndâŸ¨â‡$âˆ§âŸ©â‹®â‹”nameâ‰¡$OrâŸ¨â‡$âˆ¨âŸ©â‹®â‹”nameâ‰¡$NotâŸ¨â‡$Â¬âŸ©â†’â‡nameâŸ©â†’Æ’convert_match_patternpatternâ¦‚âŸ®astÂ·patternBitOrâˆ…âŸ¯â¦‚âŸ®strâŸ¯âŸ¨'ConvertamatchpatterntoPhitonnotation.'â†’â‹”patternIsâˆ…âŸ¨â‡$_âŸ©â†’â‹”âˆ‹(pattern,astÂ·MatchValue)âŸ¨â‡convert_nodepatternÂ·valueâŸ©â‹®â‹”âˆ‹(pattern,astÂ·MatchSingleton)âŸ¨â‹”patternÂ·valueIsâˆ…âŸ¨â‡$âˆ…âŸ©â‹®â‹”patternÂ·valueIsâŠ¤âŸ¨â‡$âŠ¤âŸ©â‹®â‹”patternÂ·valueIsâŠ¥âŸ¨â‡$âŠ¥âŸ©âŸ©â‹®â‹”âˆ‹(pattern,astÂ·MatchSequence)âŸ¨patternsâ‰”âŸ¬convert_match_patternpâˆ€pâˆˆpatternÂ·patternsâŸ­â†’â‡ã€Œ[{$,Â·joinpatterns}]ã€âŸ©â‹®â‹”âˆ‹(pattern,astÂ·MatchStar)âŸ¨â‡f'*{pattern.name}'ifpattern.nameelse'*_'âŸ©â‹®â‹”âˆ‹(pattern,astÂ·MatchMapping)âŸ¨itemsâ‰”[]â†’âˆ€(key,pat)âˆˆâ„¤(patternÂ·keys,patternÂ·patterns,strict=âŠ¥)âŸ¨key_strâ‰”convert_nodekeyâ†’pat_strâ‰”convert_match_patternpatâ†’items.appendf'{key_str}:{pat_str}'âŸ©â†’â‹”patternÂ·restâŸ¨items.appendf'**{pattern.rest}'âŸ©â†’â‡ã€Œ{{$,Â·joinitems}}ã€âŸ©â‹®â‹”âˆ‹(pattern,astÂ·MatchClass)âŸ¨clsâ‰”convert_nodepatternÂ·clsâ†’patternsâ‰”âŸ¬convert_match_patternpâˆ€pâˆˆpatternÂ·patternsâŸ­â†’kwargsâ‰”âŸ¬ã€Œ{k}={convert_match_patternp}ã€âˆ€(k,p)âˆˆâ„¤(patternÂ·kwd_attrs,patternÂ·kwd_patterns,strict=âŠ¥)âŸ­â†’argsâ‰”patterns+kwargsâ†’â‡ã€Œ{cls}({$,Â·joinargs})ã€âŸ©â‹®â‹”âˆ‹(pattern,astÂ·MatchAs)âŸ¨â‹”patternÂ·patternâŸ¨innerâ‰”convert_match_patternpatternÂ·patternâ†’â‡f'{inner}as{pattern.name}'ifpattern.nameelseinnerâŸ©â†’â‡pattern.nameifpattern.nameelse'_'âŸ©â†’â‡$_âŸ©â†’resultâ‰”convert_nodetreeâ†’logger.debugf'Treetype:{typetree}'â†’logger.debugf'Resultafterconvert_node:{result[:100]}'â†’resultâ‰”optimize_final(result,configÂ·level)â†’â‡resultâŸ©â†’Æ’decompress_from_phiton(phiton_codeâ¦‚âŸ®strâŸ¯,configâ¦‚âŸ®ConversionConfigBitOrâˆ…âŸ¯)â¦‚âŸ®strâŸ¯âŸ¨'ConvertPhitonnotationbacktoPythoncode.\n\nArgs:\nphiton_code:Phitoncodetoconvert\nconfig:Optionalconversionconfiguration\n\nReturns:\nConvertedPythoncode\n\nRaises:\nValueError:IfinputPhitoncodeisinvalid\n'â†’â‹”configIsâˆ…âŸ¨configâ‰”ConversionConfig()âŸ©â†’try:python_code=''rest_of_code=phiton_codedocstring_match=re.search('^[\'\\"].*?[\'\\"]',phiton_code,re.DOTALL)ifdocstring_match:docstring=docstring_match.group1rest_of_code=phiton_code[docstring_match.end():].lstrip()docstring=re.sub('\\\\n','\n',docstring)docstring=re.sub('\\s+','',docstring)python_code=f'"""{docstring}"""\n\n'rest_of_code=re.sub('Æ’\\w+ğ•Š','defanalyze_dataset',rest_of_code)rest_of_code=re.sub('\\w+ğ•Š\\(','analyze_datağ•Š(',rest_of_code)rest_of_code=re.sub('#\\d+','\\1',rest_of_code)rest_of_code=re.sub('#\\d+\\.\\d+','\\1',rest_of_code)rest_of_code=re.sub('\\$\\w+','"\\1"',rest_of_code)defprocess_blockscode:code=codeÂ·â‡Œ('â†’','\n')result=[]indent_stack=[0]current_indent=0current_line=''forcharincode:ifchar=='âŸ¨':result.appendcurrent_line+':'current_indent+=4indent_stack.appendcurrent_indentcurrent_line=''*current_indentelifchar=='âŸ©':ifcurrent_lineÂ·âŒ¿:result.appendcurrent_lineiflenindent_stack>1:indent_stackÂ·âŠ–()current_indent=indent_stack[-1]current_line=''*current_indentelifchar=='\n':ifcurrent_lineÂ·âŒ¿:result.appendcurrent_linecurrent_line=''*current_indentelse:current_line+=charifcurrent_lineÂ·âŒ¿:result.appendcurrent_linereturn'\n'.joinresultrest_of_code=process_blocksrest_of_codereplacements=[('â‡','return'),('â†¥','yield'),('â†¥â‹®','yieldfrom'),('â†‘','raise'),('âŸ³','while'),('âˆ€','for'),('â‹”','if'),('â‹®','else'),('âšŸ','try'),('â†¦','match'),('â‰','case'),('âŠª','assert'),('âŠ˜','pass'),('â‹¯','continue'),('âŠ ','break'),('â‰”','='),('â‰¡','=='),('â‰ ','!='),('âˆˆ','in'),('âˆ‰','notin'),('âˆ‘','sum'),('âˆ«','map'),('â¨','reduce'),('â–³','+='),('â–½','-='),('â—Š','*='),('â—†','/='),('â‰',':='),('â‰¤','<='),('â‰¥','>='),('âˆ§','and'),('âˆ¨','or'),('Â¬','not'),('âˆ…','None'),('âŠ¤','True'),('âŠ¥','False'),('Æ’','def'),('Î»','lambda'),('Î£','class'),('âŠ™','@property'),('âŠ¡','async'),('âŠ','@staticmethod'),('âŠŸ','@classmethod'),('âŸ','@abstractmethod'),('â›‹','@dataclass'),('â„“','len'),('â„œ','range'),('â„¯','enumerate'),('Ï†','filter'),('â„¤','zip'),('Ï‚','sorted'),('â„›','reversed'),('âˆƒ','any'),('â†“','min'),('â†‘','max'),('â—‹','round'),('âˆ¥','abs'),('^','pow'),('âˆ‹','isinstance'),('âˆŒ','hasattr'),('âŠ³','getattr'),('âŠ²','setattr'),('âŠ—','delattr'),('â†°','super'),('âŸ²','iter'),('âŸ¦','{'),('âŸ§','}'),('âŸ¬','['),('âŸ­',']'),('â¦…','',('â¦†',')'),('âŸ®','',('âŸ¯',')'),('â„–','np'),('â„—','pd'),('Ï‡','sklearn'),('Î¼','matplotlib'),('Î¨','torch'),('Î¦','tensorflow'),('É—','django'),('Ï±','fastapi'),('Î±','os'),('Î©','io'),('Ï„','typing'),('Î”','math'),('Î“','collections'),('Î›','itertools'),('Î˜','datetime'),('Î¶','sqlalchemy'),('Î·','requests'),('Î¾','json'),('Ï€','pathlib'),('Â®','re'),('Î³','asyncio'),('Ï','functools'),('Ï‰','operator'),('Ï','random'),('Ïƒ','string'),('Ïˆ','sys'),('Î¸','time'),('Ï…','uuid'),('Ï’','yaml'),('Î¶','zlib'),('Â·','.'),('âŒ¿','strip'),('â‡Œ','replace'),('â¨','format'),('âŠ•','append'),('âŠ–','pop'),('âŠš','values'),('âŠ›','items'),('Â§','_'),('â¦‚',':')]forold,newinreplacements:rest_of_code=rest_of_codeÂ·â‡Œ(old,new)rest_of_code=re.sub('[=!<>+\\-*/]\\s*[=!<>+\\-*/]','\\1\\2',rest_of_code)rest_of_code=re.sub('\\s+([,;:])','\\1',rest_of_code)rest_of_code=re.sub('([,;:])\\s+','\\1',rest_of_code)rest_of_code=re.sub'\\s+\\',')',rest_of_code)rest_of_code=re.sub('\\(\\s+','(',rest_of_code)word_fixes=[('in\\s+g','ing'),('or\\s+t','ort'),('f\\s+or','for'),('s\\s+or\\s+t','sort'),('cont\\s+in\\s+ue','continue'),('imp\\s+or\\s+t','import'),('doma\\s+in','domain'),('operat\\s+or','operator'),('r\\s+and\\s+om','random'),('str\\s+in\\s+g','string'),('typ\\s+in\\s+g','typing'),('is\\s+in\\s+stance','isinstance'),('m\\s+in','min'),('t\\s+or\\s+ch','torch'),('tens\\s+or\\s+flow','tensorflow'),('p\\s+and\\s+as','pandas')]forpattern,replacementinword_fixes:rest_of_code=re.sub(pattern,replacement,rest_of_code)rest_of_code=re.sub('\\w+\\s*=\\s*\\{[^}]+\\}',lambdam:f'{m.group1}={{\n{m.group2Â·âŒ¿}\n}}',rest_of_code)rest_of_code=re.sub('"[^"]+"\\s*,\\s*"[^"]+"','"\\1":"\\2",',rest_of_code)rest_of_code=re.sub("\\'[^\\']+\\'\\s*,\\s*\\'[^\\']+\\'","'\\1':'\\2',",rest_of_code)rest_of_code=re.sub('\\w+\\(','\\1(',rest_of_code)rest_of_code=re.sub('for\\s+\\w+\\s+in','for\\1in',rest_of_code)rest_of_code=re.sub('if\\s+\\w+','if\\1',rest_of_code)rest_of_code=re.sub('^[^\'\\"\\n]*[\'\\"][^\'\\"\\n]*[\'\\"]','\\1"""\\2"""',rest_of_code)rest_of_code=re.sub('if[^:]+:\\s*if[^:]+:','if\\1:\\nif\\2:',rest_of_code)rest_of_code=re.sub('if[^:]+:\\s*[^i\\n][^f\\n]','if\\1:\\n\\2',rest_of_code)rest_of_code=re.sub('printf','prâ„¤(f',rest_of_code)rest_of_code=re.sub('plt\\.title([^]','plt.title(\\1',rest_of_code)rest_of_code=re.sub('plt\\.savefig([^]','plt.savefig(\\1',rest_of_code)rest_of_code=re.sub("print\\(f\\'[^\\']+\\'","printf'\\1'",rest_of_code)rest_of_code=re.sub("plt\\.title\\(\\'[^\\']+\\'","plt.title'\\1'",rest_of_code)rest_of_code=re.sub("plt\\.savefig\\(\\'[^\\']+\\'","plt.savefig'\\1'",rest_of_code)rest_of_code=re.sub('df\\.dropcolumns','df.drop(columns',rest_of_code)rest_of_code=re.sub('\\.tolen\\\\','.toâ„“()',rest_of_code)rest_of_code=re.sub('\\.corrwithdf','.corrwith(df',rest_of_code)rest_of_code=re.sub('\\.fit_transformX','.fit_transform(X',rest_of_code)rest_of_code=re.sub('\\.corrwith\\(df\\[target_column\\]','.corrwithdf[target_column]',rest_of_code)rest_of_code=re.sub('\\.fit_transform\\(X\\[numeric_cols\\]','.fit_transformX[numeric_cols]',rest_of_code)rest_of_code=re.sub('pd\\.read_csvfile_path','pd.read_csvfile_path',rest_of_code)rest_of_code=re.sub('select_dtypesinclude=','select_dtypes(include=',rest_of_code)rest_of_code=re.sub('select_dtypes\\(include=\\[[^\\]]+\\]','select_dtypesinclude=[\\1]',rest_of_code)rest_of_code=re.sub('sort_valuesascending=','sort_values(ascending=',rest_of_code)rest_of_code=re.sub('sort_values\\ascending=[^\\]+','sort_valuesascending=\\1',rest_of_code)rest_of_code=re.sub('sort_values\\("[^"]+",ascending=[^\\]+)','sort_values("\\1",ascending=\\2)',rest_of_code)rest_of_code=re.sub('df\\.drop\\columns=\\[target_column\\]\\','df.dropcolumns=[target_column]',rest_of_code)rest_of_code=re.sub('sort_values\\("Importance",ascending=False\\)\\)','sort_values("Importance",ascending=False)',rest_of_code)rest_of_code=re.sub('if[^:]+:\\n\\s+if[^:]+:[^\\n]+','if\\1:\\nif\\2:\\n\\3',rest_of_code)python_code+=rest_of_codetry:ast.parsepython_codelogger.debug'DecompressedcodesuccessfullyparsedwithAST'exceptSyntaxErrorase:logger.warningf'Decompressedcodehassyntaxerrorsbutwillstillbeoutput:{e}'returnpython_codeexceptExceptionase:logger.error('ErrorconvertingPhitoncode:%s',stre)msg=f'InvalidPhitoncode:{e!s}'raiseValueErrormsgâŸ©â†’Æ’calculate_stats(sourceâ¦‚âŸ®strâŸ¯,resultâ¦‚âŸ®strâŸ¯)â¦‚âŸ®dict[(str,intBitOrfloat)]âŸ¯âŸ¨'Calculatecompressionstatistics.\n\nArgs:\nsource:OriginalPythoncode\nresult:ConvertedPhitoncode\n\nReturns:\nDictionarywithcompressionstatistics\n'â†’â‡{$original_chars:â„“source,$compressed_chars:â„“result,$original_lines:â„“(sourceÂ·splitlines()),$compressed_lines:â„“(resultÂ·splitlines()),$compression_ratio:â—‹(â„“result/â„“source*#100,#2)}âŸ©â†’Æ’print_stats(reportâ¦‚âŸ®dict[(str,intBitOrfloat)]âŸ¯)â¦‚âŸ®âˆ…âŸ¯âŸ¨'Printcompressionstatistics.'â†’print'\nCompressionStatistics:'â†’printf'Originalcharacters:{report['original_chars']}'â†’printf'Compressedcharacters:{report['compressed_chars']}'â†’printf'Originallines:{report['original_lines']}'â†’printf'Compressedlines:{report['compressed_lines']}'â†’printf'Compressionratio:{report['compression_ratio']}%'âŸ©â†’Æ’convert(decompressâ¦‚âŸ®boolâŸ¯,reportâ¦‚âŸ®boolâŸ¯,levelâ¦‚âŸ®intâŸ¯,commentsâ¦‚âŸ®boolâŸ¯,type_hintsâ¦‚âŸ®boolâŸ¯,minifyâ¦‚âŸ®boolâŸ¯,symbolsâ¦‚âŸ®boolâŸ¯,input_pathâ¦‚âŸ®strBitOrPathBitOrâˆ…âŸ¯,output_pathâ¦‚âŸ®strBitOrPathBitOrâˆ…âŸ¯,verboseâ¦‚âŸ®boolâŸ¯)â¦‚âŸ®âˆ…âŸ¯âŸ¨"ConvertbetweenPythonandPhitonnotation.\n\nArgs:\ninput_path:input_pathfilepathor'-'forstdin\noutput_path:output_pathfilepathor'-'forstdout\ndecompress:IfTrue,convertfromPhitontoPython\nreport:Showcompressionstatistics\nlevel:Compressionlevel1-5\ncomments:Whethertopreservecommentsinoutput_path\ntype_hints:Whethertoincludetypehintsinoutput_path\nminify:Whethertocompresswhitespace\nsymbols:Whethertouselocalsymboloptimization\nverbose:Enableverboselogging\n"â†’logger.remove()â†’logger.add(sys.stderr,level='DEBUG'ifverboseelse'INFO')â†’try:ifinput_pathisNoneorinput_path=='-':logger.debug'Readingfromstdin...'source_code=sys.stdin.read()else:input_path=Pathinput_pathifnotinput_path.exists():msg=f'input_pathfilenotfound:{input_path}'raiseFileNotFoundErrormsglogger.debugf'Readingfrom{input_path}...'source_code=input_path.read_textencoding='utf-8'conv_config=ConversionConfig(level=level,comments=comments,type_hints=type_hints,minify=minify,symbols=symbols)ifdecompress:logger.debug'DecompressingPhitontoPython...'result_code=decompress_from_phiton(source_code,conv_config)operation='decompressed'else:logger.debug'CompressingPythontoPhiton...'result_code=compress_to_phiton(source_code,conv_config)operation='compressed'ifoutput_pathisNoneoroutput_path=='-':logger.debug'Writingtostdout...'sys.stdout.writeresult_codeelse:output_path=Pathoutput_pathlogger.debugf'Writingto{output_path}...'output_path.write_text(result_code,encoding='utf-8')ifreportandoperation=='compressed':stats_data=calculate_stats(source_code,result_code)print_statsstats_datalogger.debugf'Successfully{operation}code'exceptExceptionase:logger.errorf'Error:{e!s}'sys.exit1âŸ©â†’Æ’main()â¦‚âŸ®âˆ…âŸ¯âŸ¨'Mainentrypointforphiton.'â†’try:fire.FireconvertexceptExceptionase:logger.errorf'Error:{e!s}'sys.exit1âŸ©â†’â‹”__name__â‰¡$__main__âŸ¨main()âŸ©